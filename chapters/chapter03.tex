\chapter{Methodology}

To apply the previously mentioned balancing methods to Cal Poly's SADS, significant progress was made on it's design both at the software and hardware level. Namely, a closed-loop feedback system was designed including a measurement system for attitude determination, a flight computer to process measurements and generate commands in real time, and linear actuators to shift the platform's center of mass.

\section{System Architecture}

\begin{figure}
    \centering
    \input{figures/sys_arch_passive.tikz}
    \caption{Operation flowchart during passive balancing}
    \label{fig:sys_arch_passive}
\end{figure}

\begin{figure}
    \centering
    \input{figures/sys_arch_active.tikz}
    \caption{Operation flowchart during active balancing}
    \label{fig:sys_arch_active}
\end{figure}


\section{Mechanical}

The goal of the mechanical design was to build off work completed in \cite{gilman_automatic_2024} and develop set of low-cost linear actuators that finely control the position of mass blocks. Taking lessons learned from previous iterations, the second main goal was to ensure that the size of the mass blocks was highly customizable, thus making the resulting center of mass envelope customizable. 

\subsection{Mass Sizing}

While the exact final design and mass properties of the SADS is unknown, it is still important to place an approximate upper bound on the size of the mass blocks driven by the linear actuators. This ensures that the motors and mounting hardware are not oversized and do not excessively increase the simulator's moment of inertia. A common metric used to help quantify this is a simulator's center of mass envelope. This is the set of all values $\Delta\mathbf{r}$ that the system can command when all linear actuators are in their centered positions.

One important aspect of the SADS when selecting it's desired center of mass envelope is it's symmetrical design. The two heaviest systems onboard are the reaction wheels and the mass balancing system itself. The pyrimdal reaction wheel configuration means the wheels contribute little horizontal inbalance. and the wheels are roughly on the same horizontal plane as the platform's center of rotation, so they also contribute little verical inbalance. The linear actuator design will follow the same general layout in \cite{gilman_automatic_2024}, which can be seen in FIGURE. 

The main source of inbalance will thus be introduced by relatively lighter components like batteries, sensors, the flight computer, and other miscellaneous electronics. To approximate a worse case inbalance, the heaviest of these components - the main 24V battery was placed in CAD in multiple unfavorable positions with the resulting inbalance vector recorded. 

% Isometric + Top Down CAD view of Gilman's design

\subsection{Linear Actuator Design}

The linear actuators use the same mounting configuration as the previous design. A ball screw is fixed 

% images of the ball screw and plate solution + CAD?

\section{Electrical}

The primary goal of the electrical design is to interface the newly developed linear actuators and an IMU to the flight computer. An STM32F446RE was chosen as the primary flight computer. This board has high number of GPIO pins, a maximum clock speed of 180 MHz, is low cost, and has proven compatibility with Simulink hardware suppport packages, making it desirable for this project. Despite these benefits, using a microcontroller still has numerous drawbacks, the main one being the need to reflash the board to switch bewteen programs. In the final iteration of the SADS, the flight computer ideally runs as a Linux-based RTOS, where the operator can easily load and switch between multiple programs. 

An MTi-03 was chosen as the IMU REFERRING TO LITERATURE REVIEW for it's noise characteristics and easy of integration with the STM32. The primary electrical interface between the IMU and flight computer are the  



% electrical diagram 

\section{Software}

\begin{figure}
    \centering
    \input{figures/software_flowchart.tikz}
    \caption{Functional software architecture during balancing}
    \label{fig:software_flowchart}
\end{figure}

% xbus flow chart - measurement system design

% software flow chart in config mode
% software flow chart in real time control


\section{Algorithm Implementation}

% real time Kalman filter with gravity vector?
% discussion of Simulink code generation - PID + adaptive control

% feedback control diagrams

% unscented Kalman filter detailed derivation